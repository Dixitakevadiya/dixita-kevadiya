{% comment %}
  Custom Product Grid (from scratch)
  - Exactly 6 product tiles (selectable in customizer).
  - Clicking a tile opens a vanilla JS modal with dynamic variants & Add to Cart.
  - If selected options Black & Medium: auto-add the Bonus Product ("Soft Winter Jacket") from settings.
{% endcomment %}

<section class="custom-grid" data-auto-add-jacket-handle="{{ section.settings.gift_product | default: '' | handle }}">
  <div class="container">
    {% if section.settings.title != blank %}
      <h2 class="custom-grid_title">{{ section.settings.title }}</h2>
    {% endif %}
    {% if section.blocks.size > 0 %}
    <div class="custom-inner-grid">
      {% for block in section.blocks %}
      {% assign product = all_products[block.settings.product] %}
        {% if product != blank %}
          {% assign product_obj = product %}
          {% if product_obj %}
            <div class="custom-product-grid" data-handle="{{ product_obj.handle }}" aria-label="{{ product_obj.title }}">
              <div class="custom-product-grid_image">
                {% if product_obj.featured_image %}
                  <img src="{{ product_obj.featured_image | image_url: width: 600 }}" alt="{{ product_obj.title | escape }}">
                {% else %}
                  <div style="width:100%;height:100%;background:#eee;"></div>
                {% endif %}
                <div class="dot_pos" style="left:{{ block.settings.overlay_left }}%;top:{{ block.settings. overlay_top}}%;">
                  <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="11" cy="11" r="11" fill="#F8F8F8" fill-opacity="0.9"/>
                  <path d="M11.3457 7.04175V15.5033" stroke="black" stroke-width="1.5" stroke-linecap="square" stroke-linejoin="round"/>
                  <path d="M7.11523 11.2725H15.5768" stroke="black" stroke-width="1.5" stroke-linecap="square" stroke-linejoin="round"/>
                  </svg>
                </div>
              </div>
            </div>
          {% endif %}
        {% endif %}
      {% endfor %}
    </div>
    {% endif %}
  </div>

  {%- comment -%}
   modal for show product details.
  {%- endcomment -%}
  <div id="product-modal" class="custom_modal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal_dialog" role="document">
      <header class="modal_header">
        <button class="modal_close" aria-label="Close">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M5.03784 4.94354L13.5231 13.4288" stroke="black" stroke-width="1.5" stroke-linecap="square" stroke-linejoin="round"/>
            <path d="M5.03784 13.4285L13.5231 4.94325" stroke="black" stroke-width="1.5" stroke-linecap="square" stroke-linejoin="round"/>
            </svg>
        </button>
      </header>
      <div class="modal_content_popup_wpr">
        <div class="modal_content_popup">
          <div class="modal_image"></div>
          <div class="modal_meta">
            <div class="modal_title"></div>
             <div class="js-modal-price modal_price"></div>
            <p class="js-modal-desc"></p>
          </div>
        </div>
      </div>
      <div class="modal_meta">         
          <div class="js-modal-options"></div>
        </div>
      <footer class="modal_footer">
        <button class="btn btn--primary custom_primary_btn js-modal-add"> <span class="btn_text">ADD TO CART</span>
          <span>
            <svg width="27" height="12" viewBox="0 0 27 12" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1 5.25C0.585786 5.25 0.25 5.58579 0.25 6C0.25 6.41421 0.585786 6.75 1 6.75L1 5.25ZM26.5303 6.53033C26.8232 6.23743 26.8232 5.76256 26.5303 5.46967L21.7574 0.696697C21.4645 0.403804 20.9896 0.403804 20.6967 0.696697C20.4038 0.989591 20.4038 1.46446 20.6967 1.75736L24.9393 6L20.6967 10.2426C20.4038 10.5355 20.4038 11.0104 20.6967 11.3033C20.9896 11.5962 21.4645 11.5962 21.7574 11.3033L26.5303 6.53033ZM1 6.75L26 6.75L26 5.25L1 5.25L1 6.75Z" fill="currentColor"/>
            </svg>
          </span>
        </button>
      </footer>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Custom Product Grid",
  "class": "section-custom-grid",
  "settings": [
    { "type": "text", 
      "id": "title", 
      "label": "Title"
    },
    { "type": "product", 
      "id": "gift_product", 
      "label": "Gift product to auto-add" 
    }
  ],
  "blocks": [
    {
      "type": "product_block",
      "name": "Product Block",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Select product"
        },
        {
          "type": "range",
          "id": "overlay_left",
          "label": "Left Position",
          "min": 1,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 1
        },
        {
          "type": "range",
          "id": "overlay_top",
          "label": "Top Position",
          "min": 1,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 1
        }
      ]
    }
  ],
  "max_blocks": 6,
  "presets": [{ "name": "Custom Product Grid" }]
}
{% endschema %}